# Hyperterse Configuration Schemas

> Living document. Keep this file updated whenever configuration shape or schema behavior changes.

## Overview

Hyperterse now uses three distinct JSON Schemas for `.terse`-based framework configuration:

1. **Root project schema**: `schema/root.terse.schema.json`
2. **Adapter file schema**: `schema/adapter.terse.schema.json`
3. **Route file schema**: `schema/route.terse.schema.json`

These schemas are generated by:

```bash
bun run scripts/generate-schema.ts proto/connectors/connectors.proto proto/primitives/primitives.proto
```

or via:

```bash
make generate
```

## 1) Root Project Schema

**File**: `schema/root.terse.schema.json`  
**Applies to**: root project configuration files named `.hyperterse`.

### Purpose

Defines project-level settings only (not route/adapters file contents).

### Supported fields

- `name` (required): project identifier.
- `version` (optional): project/service version metadata.
- `build` (optional):
  - `out`: output directory
  - `out_dir`: alias for `out`
  - `clean_dir`: clean output directory before build
- `server` (optional):
  - `port`: integer or numeric string
  - `log_level`: `1..4`
  - `queries.cache`:
    - `enabled` (required when `cache` is present)
    - `ttl` (seconds)
- `framework` (optional):
  - `app_dir`

## 2) Adapter Schema

**File**: `schema/adapter.terse.schema.json`  
**Applies to**: adapter `.terse` files (default convention: `app/adapters/*.terse`).

### Purpose

Validates connector configuration for a single adapter definition file.

### Supported fields

- `name` (optional): adapter name override (otherwise inferred from filename).
- `connector` (required): one of connector enum values from protobuf.
- `connection_string` (required): connector DSN/URL.
- `options` (optional): connector-specific key/value options (string, boolean, number).

## 3) Route Schema

**File**: `schema/route.terse.schema.json`  
**Applies to**: route `.terse` files (default convention: `app/routes/*/config.terse`).

### Purpose

Validates route/tool configuration for MCP tools in framework mode.

### Supported fields

- `name` (optional): explicit tool name.
- `description` (optional): tool description text.
- `use` (required unless `scripts.handler` is provided): adapter binding(s).
- `statement` (optional): DB statement for adapter-backed routes.
- `scripts` (optional):
  - `handler`
  - `input_transform`
  - `output_transform`
- `auth` (optional):
  - `plugin`
  - `policy` (string map)
- `inputs` (optional): typed input definitions.
- `data` (optional): output metadata definitions.

### Route validity rule

At least one of these must be true:

- `use` is set (DB-backed route), or
- `scripts.handler` is set (custom handler route).

## Folder Naming Flexibility

The schemas are role-based (root/adapter/route), not hardcoded to one folder name.

If your project uses custom folder names, update `.vscode/settings.json` `yaml.schemas` globs so files map to the correct schema.

## Editor schema mapping (current defaults)

`.vscode/settings.json` maps:

- `schema/route.terse.schema.json` -> `**/routes/**/config.terse`
- `schema/adapter.terse.schema.json` -> `**/adapters/**/*.terse`
- `schema/root.terse.schema.json` -> `**/.hyperterse`

## Maintenance rules

Whenever config behavior changes in parser/framework/executor:

1. Update `scripts/generate-schema.ts`.
2. Regenerate schemas in `schema/`.
3. Update this document with new/changed fields and behavior.
4. Update `.vscode/settings.json` globs if matching behavior changed.
