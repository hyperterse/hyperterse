---
title: Redis
description: Configure and use Redis with Hyperterse for caching and data structures.
sidebar:
  order: 4
---

import Aside from '@/components/admonition.astro'

Redis is supported in Hyperterse for executing commands against key-value data, caching, and data structures.

## Connection string

```yaml
adapters:
  my_redis:
    connector: redis
    connection_string: 'redis://localhost:6379/0'
```

### Format

```
redis://[:password@]host:port/db
```

### Examples

```yaml
# Local development
connection_string: "redis://localhost:6379/0"

# With password
connection_string: "redis://:mypassword@localhost:6379/0"

# Redis cloud / AWS ElastiCache
connection_string: "redis://:${REDIS_PASS}@my-redis.cache.amazonaws.com:6379/0"

# With TLS
connection_string: "rediss://:password@host:6379/0"
```

<Aside>Use `rediss://` (with double 's') for TLS connections.</Aside>

## Adapter options

```yaml
adapters:
  cache:
    connector: redis
    connection_string: 'redis://localhost:6379/0'
    options:
      pool_size: '10'
```

| Option      | Default | Description          |
| ----------- | ------- | -------------------- |
| `pool_size` | `10`    | Connection pool size |

## Setup guide

### Step 1: Start Redis

```bash
# Docker
docker run -d -p 6379:6379 redis:latest

# macOS with homebrew
brew services start redis

# Linux
sudo systemctl start redis
```

### Step 2: Configure Hyperterse

```yaml
adapters:
  cache:
    connector: redis
    connection_string: 'redis://localhost:6379/0'
```

### Step 3: Test connection

```bash
hyperterse dev -f config.terse
```

## Query examples

Redis queries use Redis commands directly. The `statement` field contains the command to execute.

### Get / SET

```yaml
queries:
  get-value:
    use: cache
    description: 'Get a cached value'
    statement: 'GET {{ inputs.key }}'
    inputs:
      key:
        type: string
        description: 'Cache key'

  set-value:
    use: cache
    description: 'Set a cached value'
    statement: 'SET {{ inputs.key }} {{ inputs.value }}'
    inputs:
      key:
        type: string
        description: 'Cache key'
      value:
        type: string
        description: 'Value to cache'
```

### Key expiration

```yaml
queries:
  set-with-expiry:
    use: cache
    description: 'Set value with TTL'
    statement: 'SETEX {{ inputs.key }} {{ inputs.ttl }} {{ inputs.value }}'
    inputs:
      key:
        type: string
      value:
        type: string
      ttl:
        type: int
        description: 'Time-to-live in seconds'
```

### Hash operations

```yaml
queries:
  get-user-session:
    use: cache
    description: 'Get user session data'
    statement: 'HGETALL session:{{ inputs.userId }}'
    inputs:
      userId:
        type: string

  set-session-field:
    use: cache
    description: 'Set session field'
    statement: 'HSET session:{{ inputs.userId }} {{ inputs.field }} {{ inputs.value }}'
    inputs:
      userId:
        type: string
      field:
        type: string
      value:
        type: string
```

### Lists

```yaml
queries:
  get-recent-events:
    use: cache
    description: 'Get recent events from list'
    statement: 'LRANGE events:{{ inputs.channel }} 0 {{ inputs.count }}'
    inputs:
      channel:
        type: string
      count:
        type: int
        description: 'Number of events to retrieve'

  push-event:
    use: cache
    description: 'Push event to list'
    statement: 'LPUSH events:{{ inputs.channel }} {{ inputs.event }}'
    inputs:
      channel:
        type: string
      event:
        type: string
```

### Sets

```yaml
queries:
  check-membership:
    use: cache
    description: 'Check if user is in a set'
    statement: 'SISMEMBER active_users {{ inputs.userId }}'
    inputs:
      userId:
        type: string

  get-active-users:
    use: cache
    description: 'Get all active users'
    statement: 'SMEMBERS active_users'
```

### Sorted sets

```yaml
queries:
  get-leaderboard:
    use: cache
    description: 'Get top players'
    statement: 'ZREVRANGE leaderboard 0 {{ inputs.count }} WITHSCORES'
    inputs:
      count:
        type: int
        description: 'Number of top players'
        optional: true
        default: '10'

  update-score:
    use: cache
    description: 'Update player score'
    statement: 'ZINCRBY leaderboard {{ inputs.points }} {{ inputs.playerId }}'
    inputs:
      playerId:
        type: string
      points:
        type: int
```

### Key management

```yaml
queries:
  delete-key:
    use: cache
    description: 'Delete a key'
    statement: 'DEL {{ inputs.key }}'
    inputs:
      key:
        type: string

  check-exists:
    use: cache
    description: 'Check if key exists'
    statement: 'EXISTS {{ inputs.key }}'
    inputs:
      key:
        type: string

  get-ttl:
    use: cache
    description: 'Get remaining TTL'
    statement: 'TTL {{ inputs.key }}'
    inputs:
      key:
        type: string
```

## Common use cases

### Session storage

```yaml
queries:
  get-session:
    use: cache
    description: 'Get user session'
    statement: 'GET session:{{ inputs.sessionId }}'
    inputs:
      sessionId:
        type: string

  invalidate-session:
    use: cache
    description: 'Invalidate session'
    statement: 'DEL session:{{ inputs.sessionId }}'
    inputs:
      sessionId:
        type: string
```

### Rate limiting

```yaml
queries:
  check-rate-limit:
    use: cache
    description: 'Check and increment rate limit'
    statement: 'INCR ratelimit:{{ inputs.clientId }}'
    inputs:
      clientId:
        type: string

  set-rate-limit-expiry:
    use: cache
    description: 'Set rate limit key expiry'
    statement: 'EXPIRE ratelimit:{{ inputs.clientId }} {{ inputs.window }}'
    inputs:
      clientId:
        type: string
      window:
        type: int
        description: 'Window in seconds'
```

### Caching database queries

Combine Redis with PostgreSQL/MySQL for caching:

```yaml
adapters:
  main_db:
    connector: postgres
    connection_string: '${DATABASE_URL}'
  cache:
    connector: redis
    connection_string: 'redis://localhost:6379/0'

queries:
  # Check cache first
  get-cached-user:
    use: cache
    statement: 'GET user:{{ inputs.userId }}'
    inputs:
      userId:
        type: string

  # Fallback to database
  get-user-from-db:
    use: main_db
    statement: 'SELECT * FROM users WHERE id = {{ inputs.userId }}'
    inputs:
      userId:
        type: int
```

## Response format

Redis responses are formatted as JSON:

```json
{
  "success": true,
  "error": "",
  "results": [
    {
      "value": "cached_data"
    }
  ]
}
```

For commands that return multiple values (like `HGETALL`), results are returned as key-value pairs.

## Common issues

### Connection refused

Ensure Redis is running:

```bash
redis-cli ping
```

### Authentication failed

Check password in connection string:

```yaml
connection_string: 'redis://:correct_password@localhost:6379/0'
```

### TLS required

For cloud Redis with TLS:

```yaml
connection_string: 'rediss://:password@host:6379/0'
```
