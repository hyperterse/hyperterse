<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 820" fill="none">
  <defs>
    <marker id="a" markerWidth="5" markerHeight="4" refX="4" refY="2" orient="auto">
      <path d="M0 0L5 2L0 4" fill="none" stroke="#555" stroke-width="1"/>
    </marker>
    <marker id="g" markerWidth="5" markerHeight="4" refX="4" refY="2" orient="auto">
      <path d="M0 0L5 2L0 4" fill="none" stroke="#2F7659" stroke-width="1"/>
    </marker>
  </defs>

  <rect width="800" height="820" fill="#0A0A0A"/>

  <g font-family="Inter, system-ui, sans-serif">

    <!-- Vertical connectors -->
    <g fill="none" stroke="#555" stroke-width="1" marker-end="url(#a)">
      <line x1="400" y1="118" x2="400" y2="148"/>
      <line x1="400" y1="218" x2="400" y2="248"/>
      <line x1="400" y1="318" x2="400" y2="348"/>
    </g>

    <!-- Fork from Input transform -->
    <path d="M400 418 L400 456 L260 456 L260 486" fill="none" stroke="#555" stroke-width="1" marker-end="url(#a)"/>
    <path d="M400 418 L400 456 L540 456 L540 486" fill="none" stroke="#555" stroke-width="1" marker-end="url(#a)"/>

    <!-- Merge into Output transform -->
    <path d="M260 556 L260 590 L400 590 L400 618" fill="none" stroke="#2F7659" stroke-width="1" marker-end="url(#g)"/>
    <path d="M540 556 L540 590 L400 590 L400 618" fill="none" stroke="#2F7659" stroke-width="1" marker-end="url(#g)"/>

    <!-- Final connector -->
    <line x1="400" y1="688" x2="400" y2="718" fill="none" stroke="#555" stroke-width="1" marker-end="url(#a)"/>

    <!-- 1. Tool resolution -->
    <rect x="240" y="48" width="320" height="70" rx="8" fill="#111" stroke="#222"/>
    <text x="268" y="82" fill="#E0E0E0" font-size="17" font-weight="600">Tool resolution</text>
    <text x="268" y="102" fill="#666" font-size="12">Match tool name to compiled definition</text>

    <!-- 2. Authentication -->
    <rect x="240" y="148" width="320" height="70" rx="8" fill="#111" stroke="#222"/>
    <text x="268" y="182" fill="#E0E0E0" font-size="17" font-weight="600">Authentication</text>
    <text x="268" y="202" fill="#666" font-size="12">Evaluate auth plugin if configured</text>

    <!-- 3. Input transform -->
    <rect x="240" y="248" width="320" height="70" rx="8" fill="#111" stroke="#222"/>
    <text x="268" y="282" fill="#E0E0E0" font-size="17" font-weight="600">Input transform</text>
    <text x="268" y="302" fill="#666" font-size="12">Run input script or pass through</text>

    <!-- 4. Execution (branch label) -->
    <rect x="240" y="348" width="320" height="70" rx="8" fill="#111" stroke="#1A3D2E"/>
    <rect x="240" y="348" width="3" height="70" rx="1.5" fill="#2F7659"/>
    <text x="268" y="382" fill="#E0E0E0" font-size="17" font-weight="600">Execution</text>
    <text x="268" y="402" fill="#666" font-size="12">One of two paths runs per invocation</text>

    <!-- 4a. Script handler -->
    <rect x="160" y="486" width="200" height="70" rx="8" fill="#111" stroke="#222"/>
    <text x="186" y="518" fill="#E0E0E0" font-size="15" font-weight="600">Script handler</text>
    <text x="186" y="536" fill="#666" font-size="11">Run custom logic</text>

    <!-- 4b. Database query -->
    <rect x="440" y="486" width="200" height="70" rx="8" fill="#111" stroke="#222"/>
    <text x="466" y="518" fill="#E0E0E0" font-size="15" font-weight="600">Database query</text>
    <text x="466" y="536" fill="#666" font-size="11">Execute via connector</text>

    <!-- 5. Output transform -->
    <rect x="240" y="618" width="320" height="70" rx="8" fill="#111" stroke="#222"/>
    <text x="268" y="652" fill="#E0E0E0" font-size="17" font-weight="600">Output transform</text>
    <text x="268" y="672" fill="#666" font-size="12">Run output script or pass through</text>

    <!-- 6. Response -->
    <rect x="240" y="718" width="320" height="70" rx="8" fill="#111" stroke="#1A3D2E"/>
    <rect x="240" y="718" width="3" height="70" rx="1.5" fill="#2F7659"/>
    <text x="268" y="752" fill="#E0E0E0" font-size="17" font-weight="600">Response</text>
    <text x="268" y="772" fill="#666" font-size="12">JSON-RPC result to caller</text>

    <!-- "or" label at fork -->
    <text x="400" y="470" fill="#555" font-size="11" font-weight="500" text-anchor="middle">or</text>

  </g>
</svg>
