---
title: V1 to V2 migration
description: Migration guide from Hyperterse v1 inline configuration to v2 filesystem-based MCP framework.
---

Hyperterse v2 is a breaking redesign. The framework shifts from a single-file query gateway to a compiled, filesystem-routed MCP framework.

## What changed

| Aspect | V1 | V2 |
|---|---|---|
| Configuration | Single `.hyperterse` with inline `adapters` and `queries` | Root config + `app/adapters/*.terse` + `app/routes/*/config.terse` |
| Routing | Query name from config keys | Filesystem: each route directory = one tool |
| Scripts | None | TypeScript handlers, input/output transforms |
| Auth | None | Per-route pluggable auth |
| Transport | HTTP query endpoints | MCP Streamable HTTP (`/mcp`) |
| Build | Runtime interprets config directly | `build` → `model.bin` → `serve` |
| Bundling | None | Scripts bundled + vendor deduplication |
| Caching | Global only | Global + per-route override |
| Observability | Basic logging | OpenTelemetry tracing + metrics + structured logging |


## Migration steps

Work through the following changes in order. Each step is independent — you can commit after each one.

### Keep the root config

Your `.hyperterse` retains `name`, `version`, and `server`. Remove `adapters` and `queries` — those move to dedicated files.

**Before:**

```yaml
name: my-api
version: 1.0.0
server:
  port: 8080
  log_level: 3
  queries:
    cache:
      enabled: true
      ttl: 60
adapters:
  main_db:
    connector: postgres
    connection_string: "{{ env.DATABASE_URL }}"
queries:
  get-user:
    use: main_db
    statement: "SELECT * FROM users WHERE id = {{ inputs.user_id }}"
    inputs:
      user_id:
        type: int
```

**After:**

```yaml
name: my-api
version: 2.0.0
server:
  port: 8080
  log_level: 3
  queries:
    cache:
      enabled: true
      ttl: 60
```

### Extract adapters

For each v1 `adapters` entry, create `app/adapters/<name>.terse`:

**`app/adapters/main-db.terse`:**

```yaml
connector: postgres
connection_string: "{{ env.DATABASE_URL }}"
```

V1 used underscores (`main_db`). V2 uses the filename (`main-db`). Update route `use` references, or add an explicit `name` field to preserve the old identifier:

```yaml
name: main_db
connector: postgres
connection_string: "{{ env.DATABASE_URL }}"
```

### Extract routes

For each v1 `queries` entry, create `app/routes/<name>/config.terse`:

**`app/routes/get-user/config.terse`:**

```yaml
description: "Get user by id"
use: main-db
statement: "SELECT * FROM users WHERE id = {{ inputs.user_id }}"
inputs:
  user_id:
    type: int
    description: "User primary key"
auth:
  plugin: allow_all
```

### Add authentication

V1 had no auth. V2 requires explicit auth per route:

- `allow_all` for public/health tools.
- `api_key` for key-protected tools.
- Custom plugins for advanced flows.

Do not leave routes without `auth` unless intentionally unauthenticated.

### Add scripts (optional)

If queries need validation or formatting that v1 handled client-side:

```yaml
scripts:
  input_transform: "./validate.ts"
  output_transform: "./format.ts"
```

### Install dependencies

If scripts import npm packages:

```bash
npm init -y && npm install dayjs uuid
```

Or with Bun:

```bash
bun init && bun add dayjs uuid
```

### Validate

```bash
hyperterse validate
```

Common issues:

| Error | Resolution |
|---|---|
| Route has neither `use` nor `scripts.handler` | Add adapter reference or handler. |
| Adapter name not found | Verify `use` matches filename or explicit `name`. |
| Unknown connector type | Use `postgres`, `mysql`, `mongodb`, or `redis`. |
| Script file not found | Verify paths are relative to route directory. |

### Test

```bash
hyperterse start --watch
```

Verify tools in `tools/list`:

```bash
curl -s -X POST http://localhost:8080/mcp \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc":"2.0","method":"tools/list","id":1}' | jq
```

### Build for production

```bash
hyperterse build -o dist
```

### Update client integration

V1 clients using `/query/{name}` must migrate to MCP `tools/call`:

**Before (V1):**

```bash
curl -X POST http://localhost:8080/query/get-user \
  -H "Content-Type: application/json" \
  -d '{"inputs": {"user_id": 42}}'
```

**After (V2):**

```bash
curl -X POST http://localhost:8080/mcp \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "method": "tools/call",
    "params": {
      "name": "get-user",
      "arguments": {"user_id": 42}
    },
    "id": 1
  }'
```


## Directory structure comparison

**V1:**

```
my-api/
  .hyperterse       # Everything in one file
```

**V2:**

```
my-api/
  .hyperterse       # Service settings only
  package.json      # npm deps (optional)
  app/
    adapters/
      main-db.terse
    routes/
      get-user/
        config.terse
        validate.ts        # optional
        format.ts          # optional
      list-orders/
        config.terse
```


## Breaking changes

| Change | Impact | Action |
|---|---|---|
| Inline `adapters` removed | Config will not parse | Extract to `app/adapters/*.terse` |
| Inline `queries` removed | Config will not parse | Extract to `app/routes/*/config.terse` |
| `/query/{name}` removed | HTTP clients break | Migrate to MCP `tools/call` |
| Auth now per-route | Routes unauthenticated by default | Add `auth` blocks |
| DSL parser deprecated | Text-format blocks unsupported | Convert to YAML |
| Build step introduced | Direct interpretation replaced | Add `build` + `serve` to pipeline |
